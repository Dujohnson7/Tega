{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import Chart from\"chart.js\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function CardLineChart(){const[chartData,setChartData]=useState(null);useEffect(()=>{const fetchWeeklyRevenue=async()=>{try{const now=new Date();const startOfWeek=new Date(now);startOfWeek.setDate(now.getDate()-now.getDay()+(now.getDay()===0?-6:1));startOfWeek.setHours(0,0,0,0);const endOfWeek=new Date(startOfWeek);endOfWeek.setDate(startOfWeek.getDate()+6);endOfWeek.setHours(23,59,59,999);const token=localStorage.getItem(\"token\");const response=await fetch(\"http://localhost:5000/api/reports/date-range?start=\".concat(startOfWeek.getTime(),\"&end=\").concat(endOfWeek.getTime()),{method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)},credentials:\"include\"});if(!response.ok){const errorText=await response.text();console.error(\"Failed to fetch revenue:\",response.status,errorText);return;}const tickets=await response.json();console.log(\"Fetched tickets:\",tickets);const labels=[\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\",\"Sun\"];const revenuePerDay=Array(7).fill(0);tickets.forEach(ticket=>{const ticketDate=new Date(ticket.date);const day=ticketDate.getDay();const index=day===0?6:day-1;revenuePerDay[index]+=ticket.totalAmount||0;});console.log(\"Revenue per day:\",revenuePerDay);setChartData({labels,datasets:[{label:\"Revenue (RWF)\",backgroundColor:\"rgba(59,130,246,0.1)\",borderColor:\"rgb(59,130,246)\",data:revenuePerDay,fill:true,tension:0.4}]});}catch(err){console.error(\"Error fetching revenue:\",err);}};fetchWeeklyRevenue();},[]);useEffect(()=>{if(!chartData)return;const ctx=document.getElementById(\"line-chart\").getContext(\"2d\");if(window.myLine)window.myLine.destroy();window.myLine=new Chart(ctx,{type:\"line\",data:chartData,options:{maintainAspectRatio:false,responsive:true,legend:{labels:{fontColor:\"white\"},align:\"end\",position:\"bottom\"},scales:{xAxes:[{ticks:{fontColor:\"white\"}}],yAxes:[{ticks:{fontColor:\"white\",beginAtZero:true}}]}}});return()=>window.myLine&&window.myLine.destroy();},[chartData]);return/*#__PURE__*/_jsxs(\"div\",{className:\"relative flex flex-col min-w-0 break-words w-full mb-6 shadow-lg rounded bg-blueGray-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rounded-t px-4 py-3 bg-transparent\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"text-white text-xl font-semibold\",children:\"Revenue Overview\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-4 flex-auto\",children:/*#__PURE__*/_jsx(\"div\",{className:\"relative h-350-px\",children:/*#__PURE__*/_jsx(\"canvas\",{id:\"line-chart\"})})})]});}","map":{"version":3,"names":["React","useEffect","useState","Chart","jsx","_jsx","jsxs","_jsxs","CardLineChart","chartData","setChartData","fetchWeeklyRevenue","now","Date","startOfWeek","setDate","getDate","getDay","setHours","endOfWeek","token","localStorage","getItem","response","fetch","concat","getTime","method","headers","Authorization","credentials","ok","errorText","text","console","error","status","tickets","json","log","labels","revenuePerDay","Array","fill","forEach","ticket","ticketDate","date","day","index","totalAmount","datasets","label","backgroundColor","borderColor","data","tension","err","ctx","document","getElementById","getContext","window","myLine","destroy","type","options","maintainAspectRatio","responsive","legend","fontColor","align","position","scales","xAxes","ticks","yAxes","beginAtZero","className","children","id"],"sources":["D:/AUCA/AUCA INNOVATION CENTER/WebTech/Final/TegaBus/frontend/tegaPortal/src/components/Cards/CardLineChart.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport Chart from \"chart.js\";\n\nexport default function CardLineChart() {\n  const [chartData, setChartData] = useState(null);\n\n  useEffect(() => {\n    const fetchWeeklyRevenue = async () => {\n      try {\n        const now = new Date();\n        const startOfWeek = new Date(now);\n        startOfWeek.setDate(now.getDate() - now.getDay() + (now.getDay() === 0 ? -6 : 1));\n        startOfWeek.setHours(0, 0, 0, 0);\n        \n        const endOfWeek = new Date(startOfWeek);\n        endOfWeek.setDate(startOfWeek.getDate() + 6);\n        endOfWeek.setHours(23, 59, 59, 999);\n\n        const token = localStorage.getItem(\"token\");\n\n        const response = await fetch(\n          `http://localhost:5000/api/reports/date-range?start=${startOfWeek.getTime()}&end=${endOfWeek.getTime()}`,\n          {\n            method: \"GET\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: `Bearer ${token}`,\n            },\n            credentials: \"include\",\n          }\n        );\n\n        if (!response.ok) {\n          const errorText = await response.text();\n          console.error(\"Failed to fetch revenue:\", response.status, errorText);\n          return;\n        }\n\n        const tickets = await response.json();\n        console.log(\"Fetched tickets:\", tickets); \n\n        const labels = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"];\n        const revenuePerDay = Array(7).fill(0);\n\n        tickets.forEach(ticket => {\n          const ticketDate = new Date(ticket.date);\n          const day = ticketDate.getDay();  \n          const index = day === 0 ? 6 : day - 1;  \n          revenuePerDay[index] += ticket.totalAmount || 0;\n        });\n\n        console.log(\"Revenue per day:\", revenuePerDay);  \n        setChartData({\n          labels,\n          datasets: [\n            {\n              label: \"Revenue (RWF)\",\n              backgroundColor: \"rgba(59,130,246,0.1)\",\n              borderColor: \"rgb(59,130,246)\",\n              data: revenuePerDay,\n              fill: true,\n              tension: 0.4,\n            },\n          ],\n        });\n      } catch (err) {\n        console.error(\"Error fetching revenue:\", err);\n      }\n    };\n\n    fetchWeeklyRevenue();\n  }, []);\n\n  useEffect(() => {\n    if (!chartData) return;\n\n    const ctx = document.getElementById(\"line-chart\").getContext(\"2d\");\n    if (window.myLine) window.myLine.destroy();\n\n    window.myLine = new Chart(ctx, {\n      type: \"line\",\n      data: chartData,\n      options: {\n        maintainAspectRatio: false,\n        responsive: true,\n        legend: { labels: { fontColor: \"white\" }, align: \"end\", position: \"bottom\" },\n        scales: {\n          xAxes: [{ ticks: { fontColor: \"white\" } }],\n          yAxes: [{ ticks: { fontColor: \"white\", beginAtZero: true } }],\n        },\n      },\n    });\n\n    return () => window.myLine && window.myLine.destroy();\n  }, [chartData]);\n\n  return (\n    <div className=\"relative flex flex-col min-w-0 break-words w-full mb-6 shadow-lg rounded bg-blueGray-700\">\n      <div className=\"rounded-t px-4 py-3 bg-transparent\">\n        <h2 className=\"text-white text-xl font-semibold\">Revenue Overview</h2>\n      </div>\n      <div className=\"p-4 flex-auto\">\n        <div className=\"relative h-350-px\">\n          <canvas id=\"line-chart\"></canvas>\n        </div>\n      </div>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}