{"ast":null,"code":"import _objectSpread from\"D:/AUCA/AUCA INNOVATION CENTER/WebTech/Final/TegaBus/frontend/tegaPortal/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import{useHistory,useParams}from\"react-router-dom\";import jsPDF from\"jspdf\";import autoTable from\"jspdf-autotable\";import QRCode from\"qrcode\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const generateTicketNumber=()=>{const timestamp=Date.now().toString(36);const randomStr=Math.random().toString(36).substr(2,5);return\"TKT-\".concat(timestamp,\"-\").concat(randomStr).toUpperCase();};export default function TicketEdit(){const history=useHistory();const{id}=useParams();const[ticketData,setTicketData]=useState({ticketNumber:\"\",names:\"\",phone:\"\",express:\"\",schedule:\"\",busPlateNo:\"\",seatNo:\"\",totalAmount:0,payState:\"PAID\",date:\"\"});const[expressList,setExpressList]=useState([]);const[scheduleList,setScheduleList]=useState([]);const[busList,setBusList]=useState([]);const[role,setRole]=useState(\"\");const[existingTickets,setExistingTickets]=useState([]);const[loading,setLoading]=useState(true);const[availableSeats,setAvailableSeats]=useState(0);const[error,setError]=useState(\"\");useEffect(()=>{const fetchData=async()=>{try{var _ticket$express,_ticket$schedule,_ticket$schedule2;const token=localStorage.getItem(\"token\");const expressId=localStorage.getItem(\"expressId\");if(!token){alert(\"You are not logged in. Redirecting to login page.\");history.push(\"/login\");return;}let userRole=\"\";const userObj=localStorage.getItem(\"user\");if(userObj){const user=JSON.parse(userObj);userRole=user.role?user.role.toUpperCase():\"\";}else{userRole=localStorage.getItem(\"role\")?localStorage.getItem(\"role\").toUpperCase():\"\";}setRole(userRole);const ticketResponse=await fetch(\"http://localhost:5000/api/tickets/\".concat(id),{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\",\"X-Express-Id\":expressId||\"\"}});if(!ticketResponse.ok){throw new Error(\"Failed to fetch ticket data: \".concat(ticketResponse.status));}const ticket=await ticketResponse.json();setTicketData({ticketNumber:ticket.ticketNumber||\"\",names:ticket.names||\"\",phone:ticket.phone||\"\",express:((_ticket$express=ticket.express)===null||_ticket$express===void 0?void 0:_ticket$express.id)||\"\",schedule:((_ticket$schedule=ticket.schedule)===null||_ticket$schedule===void 0?void 0:_ticket$schedule.id)||\"\",busPlateNo:ticket.busPlateNo||\"\",seatNo:ticket.seatNo||\"\",totalAmount:ticket.totalAmount||0,payState:ticket.payState||\"PAID\",date:ticket.date||((_ticket$schedule2=ticket.schedule)===null||_ticket$schedule2===void 0?void 0:_ticket$schedule2.date)||\"\"});const expressResponse=await fetch(\"http://localhost:5000/api/express/all\",{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\"}});if(!expressResponse.ok){if(expressResponse.status===403){throw new Error(\"Access forbidden. Please check your authentication.\");}throw new Error(\"Cannot fetch express list\");}const expresses=await expressResponse.json();setExpressList(expresses);let schedules=[];let scheduleResponse;try{scheduleResponse=await fetch(\"http://localhost:5000/api/tickets/schedule\",{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\",\"X-Express-Id\":expressId||\"\"}});if(!scheduleResponse.ok){scheduleResponse=await fetch(\"http://localhost:5000/api/tickschedule\",{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\",\"X-Express-Id\":expressId||\"\"}});}if(!scheduleResponse.ok){if(scheduleResponse.status===403){throw new Error(\"Access forbidden to schedules. Check your permissions.\");}throw new Error(\"Cannot fetch schedule list\");}schedules=await scheduleResponse.json();}catch(scheduleError){console.error(\"Schedule fetch error:\",scheduleError);schedules=[];}const today=new Date();const filteredSchedules=schedules.filter(sch=>{if(!sch||!sch.date)return false;const scheduleDate=new Date(sch.date);const isNotExpired=scheduleDate>=today;const matchesExpress=userRole===\"SUPER_ADMIN\"?true:sch.express&&sch.express.id===expressId;return isNotExpired&&matchesExpress&&sch.express;});const finalSchedules=userRole!==\"SUPER_ADMIN\"&&expressId?filteredSchedules.filter(sch=>sch.express&&sch.express.id===expressId):filteredSchedules;setScheduleList(finalSchedules);try{const busResponse=await fetch(\"http://localhost:5000/api/tickets/bus\",{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\",\"X-Express-Id\":expressId||\"\"}});if(busResponse.ok){setBusList(await busResponse.json());}}catch(busError){console.error(\"Bus fetch error:\",busError);}try{const ticketsResponse=await fetch(\"http://localhost:5000/api/tickets/all\",{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\",\"X-Express-Id\":expressId||\"\"}});if(ticketsResponse.ok){setExistingTickets(await ticketsResponse.json());}}catch(ticketError){console.error(\"Tickets fetch error:\",ticketError);}if(userRole!==\"SUPER_ADMIN\"&&expressId){setTicketData(prev=>_objectSpread(_objectSpread({},prev),{},{express:expressId}));}setLoading(false);}catch(error){console.error(\"Error fetching data:\",error);setError(error.message);setLoading(false);alert(\"Error: \"+error.message);}};fetchData();},[id,history]);useEffect(()=>{if(!ticketData.schedule)return;const selectedSchedule=scheduleList.find(s=>s.id===ticketData.schedule);if(!selectedSchedule||!selectedSchedule.bus)return;const bookedSeats=existingTickets.filter(t=>t.schedule&&t.schedule.id===ticketData.schedule&&t.id!==id).map(t=>t.seatNo);const remainingSeats=selectedSchedule.bus.busSize-bookedSeats.length;setAvailableSeats(remainingSeats);const nextSeat=[];for(let i=1;i<=selectedSchedule.bus.busSize;i++){if(!bookedSeats.includes(i)){nextSeat.push(i);}}setTicketData(prev=>_objectSpread(_objectSpread({},prev),{},{seatNo:nextSeat.includes(parseInt(prev.seatNo))?prev.seatNo:nextSeat.length>0?nextSeat[0]:\"\",busPlateNo:selectedSchedule.bus.plateNo,totalAmount:selectedSchedule.destination.cost||0,date:selectedSchedule.date||prev.date}));},[ticketData.schedule,scheduleList,existingTickets,id]);useEffect(()=>{if(role!==\"SUPER_ADMIN\"||!ticketData.express)return;const fetchSchedulesForExpress=async()=>{try{const token=localStorage.getItem(\"token\");let scheduleResponse=await fetch(\"http://localhost:5000/api/tickets/schedule\",{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\",\"X-Express-Id\":ticketData.express}});if(!scheduleResponse.ok){scheduleResponse=await fetch(\"http://localhost:5000/api/tickschedule\",{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\",\"X-Express-Id\":ticketData.express}});}if(!scheduleResponse.ok)throw new Error(\"Cannot fetch schedules for express\");const schedules=await scheduleResponse.json();const today=new Date();const filteredSchedules=schedules.filter(sch=>{if(!sch||!sch.date)return false;const scheduleDate=new Date(sch.date);return scheduleDate>=today&&sch.express&&sch.express.id===ticketData.express&&sch.express;});setScheduleList(filteredSchedules);}catch(error){console.error(\"Error fetching schedules:\",error);setError(error.message);}};fetchSchedulesForExpress();},[ticketData.express,role]);const generateQRCodeData=(ticket,selectedSchedule,selectedExpress)=>{const formatDate=dateString=>{const date=new Date(dateString);return\"\".concat(date.getMonth()+1,\"/\").concat(date.getDate(),\"/\").concat(date.getFullYear());};const qrData=\"\\n      Ticket: \".concat(ticket.ticketNumber,\"\\n      Express: \").concat(selectedExpress.expressName,\"\\n      Route: \").concat(selectedSchedule.destination.fromLocation,\" - \").concat(selectedSchedule.destination.toLocation,\"\\n      Time: \").concat(selectedSchedule.time,\"\\n      Date: \").concat(formatDate(selectedSchedule.date),\"\\n      Bus: \").concat(ticket.busPlateNo,\"\\n      Seat: \").concat(ticket.seatNo,\"\\n      Passenger: \").concat(ticket.names,\"\\n      Amount: \").concat(ticket.totalAmount,\" Rwf\\n      Status: \").concat(ticket.payState,\"\\n      Powered By TEGABUS\\n    \").trim();return qrData;};const generateQRCodeImage=async qrCodeData=>{try{const qrCodeDataURL=await QRCode.toDataURL(qrCodeData,{width:120,margin:1,color:{dark:\"#2c3e50\",light:\"#ffffff\"}});return qrCodeDataURL;}catch(error){console.error(\"Error generating QR code:\",error);throw error;}};const generatePDF=async ticket=>{const selectedSchedule=scheduleList.find(s=>s.id===ticket.schedule.id);const selectedExpress=expressList.find(e=>e.id===ticket.express.id);if(!selectedSchedule||!selectedExpress){console.error(\"Missing schedule or express data:\",{selectedSchedule,selectedExpress});alert(\"Cannot generate PDF: Missing schedule or express data.\");return;}const logoUrl=\"http://localhost:5000/uploads/\".concat(selectedExpress.expressLogo);const doc=new jsPDF();const qrCodeData=generateQRCodeData(ticket,selectedSchedule,selectedExpress);doc.setFillColor(74,107,136);doc.rect(0,0,210,25,\"F\");doc.setFontSize(20);doc.setTextColor(255,255,255);doc.setFont(undefined,\"bold\");doc.text(\"\".concat(selectedExpress.expressName||\"N/A\"),105,12,{align:\"center\"});doc.setFontSize(10);doc.setTextColor(255,255,255);doc.text(\"Premium Travel Experience\",105,18,{align:\"center\"});doc.setDrawColor(200,200,200);doc.setFillColor(255,255,255);doc.roundedRect(10,30,190,130,8,8,\"FD\");doc.setDrawColor(74,107,136);doc.setLineWidth(1);doc.roundedRect(12,32,186,126,6,6,\"S\");doc.setFillColor(74,107,136);doc.roundedRect(15,35,180,15,4,4,\"F\");doc.setFontSize(16);doc.setTextColor(255,255,255);doc.setFont(undefined,\"bold\");doc.text(\"ELECTRONIC TICKET\",105,45,{align:\"center\"});doc.setFillColor(240,240,240);doc.roundedRect(70,55,70,8,4,4,\"F\");doc.setFontSize(10);doc.setTextColor(74,107,136);doc.setFont(undefined,\"bold\");doc.text(\"Ticket #: \".concat(ticket.ticketNumber||\"N/A\"),105,60,{align:\"center\"});try{const qrCodeDataURL=await generateQRCodeImage(qrCodeData);doc.setFillColor(250,250,250);doc.roundedRect(135,70,60,80,5,5,\"F\");doc.setDrawColor(200,200,200);doc.roundedRect(135,70,60,80,5,5,\"S\");doc.addImage(qrCodeDataURL,\"PNG\",140,75,50,50);doc.setFontSize(9);doc.setTextColor(100,100,100);doc.text(\"Scan Me\",165,130,{align:\"center\"});}catch(error){console.error(\"Error generating QR code:\",error);doc.setFontSize(8);doc.setTextColor(0,0,0);doc.text(\"QR Code Error\",160,85,{align:\"center\"});}doc.setFontSize(12);doc.setTextColor(74,107,136);doc.setFont(undefined,\"bold\");doc.text(\"PASSENGER DETAILS\",65,75);doc.setDrawColor(74,107,136);doc.setLineWidth(0.5);doc.line(20,78,130,78);doc.setFontSize(10);doc.setTextColor(0,0,0);doc.setFont(undefined,\"normal\");doc.text(\"Name: \".concat(ticket.names||\"-\"),20,85);doc.text(\"Phone: \".concat(ticket.phone||\"-\"),20,92);doc.setFontSize(12);doc.setTextColor(74,107,136);doc.setFont(undefined,\"bold\");doc.text(\"JOURNEY INFORMATION\",65,110);doc.line(20,113,130,113);doc.setFontSize(10);doc.setTextColor(0,0,0);doc.setFont(undefined,\"normal\");doc.text(\"Route: \".concat(selectedSchedule.destination.fromLocation,\" - \").concat(selectedSchedule.destination.toLocation),20,120);doc.text(\"Time: \".concat(selectedSchedule.time||\"-\"),20,127);doc.text(\"Date: \".concat(selectedSchedule.date?new Date(selectedSchedule.date).toLocaleDateString():\"-\"),20,134);doc.text(\"Bus: \".concat(ticket.busPlateNo||\"-\"),20,141);doc.text(\"Seat: \".concat(ticket.seatNo||\"-\"),80,141);if(ticket.payState===\"PAID\"){doc.setFillColor(76,175,80);}else{doc.setFillColor(244,67,54);}doc.roundedRect(20,148,50,8,4,4,\"F\");doc.setFontSize(10);doc.setTextColor(255,255,255);doc.text(\"Status: \".concat(ticket.payState||\"PENDING\"),45,153,{align:\"center\"});doc.setFontSize(10);doc.setTextColor(0,0,0);doc.text(\"Price: \".concat(ticket.totalAmount||0,\" Rwf\"),100,153);doc.setFillColor(74,107,136);doc.rect(0,165,210,15,\"F\");doc.setFontSize(11);doc.setTextColor(255,255,255);doc.text(\"Powered By TEGABUS\",105,172,{align:\"center\"});doc.setFillColor(44,62,80);for(let i=0;i<210;i+=10){doc.circle(i,180,1,\"F\");}doc.setFontSize(8);doc.setTextColor(150,150,150);doc.text(\"Please present this ticket during boarding • Please come early if you delay Ticket will be Expired • Thank you for traveling with us!\",105,185,{align:\"center\"});doc.text(\"Generated on \"+new Date().toLocaleString(),105,190,{align:\"center\"});try{doc.addImage(logoUrl,\"PNG\",175,3,25,20,undefined,\"FAST\");}catch(error){console.error(\"Error adding logo to PDF:\",error);}doc.save(\"ticket_\".concat(ticket.ticketNumber||\"unknown\",\".pdf\"));const pdfOutput=doc.output(\"bloburl\");const printWindow=window.open(pdfOutput);if(printWindow){printWindow.onload=()=>{printWindow.print();setTimeout(()=>{printWindow.close();},500);};}else{console.error(\"Failed to open print window. Ensure pop-ups are allowed.\");}};const handleInputChange=e=>{const{name,value}=e.target;if(name===\"ticketNumber\")return;setTicketData(_objectSpread(_objectSpread({},ticketData),{},{[name]:value}));};const handleSubmit=async e=>{e.preventDefault();if(!ticketData.seatNo){return alert(\"No seats available for the selected schedule.\");}if(!ticketData.date){return alert(\"Ticket date is missing. Please select a valid schedule.\");}try{const token=localStorage.getItem(\"token\");const expressId=localStorage.getItem(\"expressId\");const payload={id:id,ticketNumber:ticketData.ticketNumber,names:ticketData.names,phone:ticketData.phone,express:{id:ticketData.express},schedule:{id:ticketData.schedule},busPlateNo:ticketData.busPlateNo,seatNo:parseInt(ticketData.seatNo),totalAmount:parseFloat(ticketData.totalAmount),payState:ticketData.payState,date:ticketData.date};console.log(\"Payload sent to backend:\",payload);const response=await fetch(\"http://localhost:5000/api/tickets/update/\".concat(id),{method:\"PUT\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token),\"X-Express-Id\":expressId||\"\"},body:JSON.stringify(payload)});if(!response.ok){const errorText=await response.text();throw new Error(errorText||\"Failed to update ticket: \".concat(response.status));}const updatedTicket=await response.json();alert(\"Ticket updated successfully!\");if(updatedTicket.payState!==\"PENDING\"){await generatePDF(updatedTicket);}else{console.log(\"PDF generation skipped: Payment status is PENDING\");}history.push(\"/admin/tickets\");}catch(error){console.error(\"Error updating ticket:\",error);alert(\"Error updating ticket: \"+error.message);}};const handleCancel=()=>history.push(\"/admin/tickets\");if(loading)return/*#__PURE__*/_jsx(\"p\",{className:\"text-center p-6\",children:\"Loading...\"});return/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-full xl:w-8/12 mb-12 xl:mb-0 px-4 mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative flex flex-col min-w-0 break-words w-full mb-6 shadow-lg rounded-lg bg-white border-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-t bg-white mb-0 px-6 py-6 flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"text-blueGray-700 text-xl font-bold\",children:\"Edit Ticket\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCancel,className:\"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600\",children:\"Back\"})]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mx-6 mt-4\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"font-bold\",children:\"Error: \"}),/*#__PURE__*/_jsx(\"span\",{className:\"block sm:inline\",children:error})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"flex-auto px-4 lg:px-10 py-10 pt-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Ticket Number\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"ticketNumber\",value:ticketData.ticketNumber,readOnly:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Passenger Name *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"names\",value:ticketData.names,onChange:handleInputChange,readOnly:role!==\"SUPER_ADMIN\",required:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Phone *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"phone\",value:ticketData.phone,onChange:handleInputChange,readOnly:role!==\"SUPER_ADMIN\",required:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg\"})]}),role===\"SUPER_ADMIN\"&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Express *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"express\",value:ticketData.express,onChange:handleInputChange,required:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Express\"}),expressList.map(exp=>/*#__PURE__*/_jsx(\"option\",{value:exp.id,children:exp.expressName},exp.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Schedule *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"schedule\",value:ticketData.schedule,onChange:handleInputChange,readOnly:role!==\"SUPER_ADMIN\",required:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Schedule\"}),scheduleList.map(sch=>/*#__PURE__*/_jsxs(\"option\",{value:sch.id,children:[sch.destination.fromLocation,\" - \",sch.destination.toLocation,\" (\",sch.date,\" \",sch.time,\")\"]},sch.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Bus Plate Number *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"busPlateNo\",value:ticketData.busPlateNo,readOnly:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:[\"Seat Number * (Available: \",availableSeats,\")\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"seatNo\",value:ticketData.seatNo||\"\",readOnly:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Cost *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"totalAmount\",value:ticketData.totalAmount,readOnly:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Payment Status *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"payState\",value:ticketData.payState,onChange:handleInputChange,required:true,className:\"w-full px-4 py-3 border border-gray-300 rounded-lg\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"PENDING\",children:\"Pending\"}),/*#__PURE__*/_jsx(\"option\",{value:\"PAID\",children:\"Paid\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-6 border-t border-gray-200\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCancel,className:\"px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",className:\"px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-700 transition-colors\",disabled:availableSeats===0||!ticketData.date,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-ticket-alt mr-2\"}),\" Save\"]})]})]})]})})});}","map":{"version":3,"names":["React","useState","useEffect","useHistory","useParams","jsPDF","autoTable","QRCode","jsx","_jsx","jsxs","_jsxs","generateTicketNumber","timestamp","Date","now","toString","randomStr","Math","random","substr","concat","toUpperCase","TicketEdit","history","id","ticketData","setTicketData","ticketNumber","names","phone","express","schedule","busPlateNo","seatNo","totalAmount","payState","date","expressList","setExpressList","scheduleList","setScheduleList","busList","setBusList","role","setRole","existingTickets","setExistingTickets","loading","setLoading","availableSeats","setAvailableSeats","error","setError","fetchData","_ticket$express","_ticket$schedule","_ticket$schedule2","token","localStorage","getItem","expressId","alert","push","userRole","userObj","user","JSON","parse","ticketResponse","fetch","method","headers","Authorization","ok","Error","status","ticket","json","expressResponse","expresses","schedules","scheduleResponse","scheduleError","console","today","filteredSchedules","filter","sch","scheduleDate","isNotExpired","matchesExpress","finalSchedules","busResponse","busError","ticketsResponse","ticketError","prev","_objectSpread","message","selectedSchedule","find","s","bus","bookedSeats","t","map","remainingSeats","busSize","length","nextSeat","i","includes","parseInt","plateNo","destination","cost","fetchSchedulesForExpress","generateQRCodeData","selectedExpress","formatDate","dateString","getMonth","getDate","getFullYear","qrData","expressName","fromLocation","toLocation","time","trim","generateQRCodeImage","qrCodeData","qrCodeDataURL","toDataURL","width","margin","color","dark","light","generatePDF","e","logoUrl","expressLogo","doc","setFillColor","rect","setFontSize","setTextColor","setFont","undefined","text","align","setDrawColor","roundedRect","setLineWidth","addImage","line","toLocaleDateString","circle","toLocaleString","save","pdfOutput","output","printWindow","window","open","onload","print","setTimeout","close","handleInputChange","name","value","target","handleSubmit","preventDefault","payload","parseFloat","log","response","body","stringify","errorText","updatedTicket","handleCancel","className","children","onClick","onSubmit","type","readOnly","onChange","required","exp","disabled"],"sources":["D:/AUCA/AUCA INNOVATION CENTER/WebTech/Final/TegaBus/frontend/tegaPortal/src/views/admin/TicketEdit.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useHistory, useParams } from \"react-router-dom\";\r\nimport jsPDF from \"jspdf\";\r\nimport autoTable from \"jspdf-autotable\";\r\nimport QRCode from \"qrcode\";\r\n \r\nconst generateTicketNumber = () => {\r\n  const timestamp = Date.now().toString(36);\r\n  const randomStr = Math.random().toString(36).substr(2, 5);\r\n  return `TKT-${timestamp}-${randomStr}`.toUpperCase();\r\n};\r\n\r\nexport default function TicketEdit() {\r\n  const history = useHistory();\r\n  const { id } = useParams();  \r\n\r\n  const [ticketData, setTicketData] = useState({\r\n    ticketNumber: \"\",\r\n    names: \"\",\r\n    phone: \"\",\r\n    express: \"\",\r\n    schedule: \"\",\r\n    busPlateNo: \"\",\r\n    seatNo: \"\",\r\n    totalAmount: 0,\r\n    payState: \"PAID\",\r\n    date: \"\",  \r\n  });\r\n\r\n  const [expressList, setExpressList] = useState([]);\r\n  const [scheduleList, setScheduleList] = useState([]);\r\n  const [busList, setBusList] = useState([]);\r\n  const [role, setRole] = useState(\"\");\r\n  const [existingTickets, setExistingTickets] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [availableSeats, setAvailableSeats] = useState(0);\r\n  const [error, setError] = useState(\"\");\r\n \r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"token\");\r\n        const expressId = localStorage.getItem(\"expressId\");\r\n\r\n        if (!token) {\r\n          alert(\"You are not logged in. Redirecting to login page.\");\r\n          history.push(\"/login\");\r\n          return;\r\n        }\r\n \r\n        let userRole = \"\";\r\n        const userObj = localStorage.getItem(\"user\");\r\n        if (userObj) {\r\n          const user = JSON.parse(userObj);\r\n          userRole = user.role ? user.role.toUpperCase() : \"\";\r\n        } else {\r\n          userRole = localStorage.getItem(\"role\") ? localStorage.getItem(\"role\").toUpperCase() : \"\";\r\n        }\r\n        setRole(userRole);\r\n \r\n        const ticketResponse = await fetch(`http://localhost:5000/api/tickets/${id}`, {\r\n          method: \"GET\",\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n            \"Content-Type\": \"application/json\",\r\n            \"X-Express-Id\": expressId || \"\",\r\n          },\r\n        });\r\n\r\n        if (!ticketResponse.ok) {\r\n          throw new Error(`Failed to fetch ticket data: ${ticketResponse.status}`);\r\n        }\r\n\r\n        const ticket = await ticketResponse.json();\r\n        setTicketData({\r\n          ticketNumber: ticket.ticketNumber || \"\",\r\n          names: ticket.names || \"\",\r\n          phone: ticket.phone || \"\",\r\n          express: ticket.express?.id || \"\",\r\n          schedule: ticket.schedule?.id || \"\",\r\n          busPlateNo: ticket.busPlateNo || \"\",\r\n          seatNo: ticket.seatNo || \"\",\r\n          totalAmount: ticket.totalAmount || 0,\r\n          payState: ticket.payState || \"PAID\",\r\n          date: ticket.date || ticket.schedule?.date || \"\",  \r\n        });\r\n \r\n        const expressResponse = await fetch(\"http://localhost:5000/api/express/all\", {\r\n          method: \"GET\",\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n        });\r\n\r\n        if (!expressResponse.ok) {\r\n          if (expressResponse.status === 403) {\r\n            throw new Error(\"Access forbidden. Please check your authentication.\");\r\n          }\r\n          throw new Error(\"Cannot fetch express list\");\r\n        }\r\n\r\n        const expresses = await expressResponse.json();\r\n        setExpressList(expresses);\r\n \r\n        let schedules = [];\r\n        let scheduleResponse;\r\n\r\n        try {\r\n          scheduleResponse = await fetch(\"http://localhost:5000/api/tickets/schedule\", {\r\n            method: \"GET\",\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n              \"Content-Type\": \"application/json\",\r\n              \"X-Express-Id\": expressId || \"\",\r\n            },\r\n          });\r\n\r\n          if (!scheduleResponse.ok) {\r\n            scheduleResponse = await fetch(\"http://localhost:5000/api/tickschedule\", {\r\n              method: \"GET\",\r\n              headers: {\r\n                Authorization: `Bearer ${token}`,\r\n                \"Content-Type\": \"application/json\",\r\n                \"X-Express-Id\": expressId || \"\",\r\n              },\r\n            });\r\n          }\r\n\r\n          if (!scheduleResponse.ok) {\r\n            if (scheduleResponse.status === 403) {\r\n              throw new Error(\"Access forbidden to schedules. Check your permissions.\");\r\n            }\r\n            throw new Error(\"Cannot fetch schedule list\");\r\n          }\r\n\r\n          schedules = await scheduleResponse.json();\r\n        } catch (scheduleError) {\r\n          console.error(\"Schedule fetch error:\", scheduleError);\r\n          schedules = [];\r\n        }\r\n\r\n        const today = new Date();\r\n        const filteredSchedules = schedules.filter((sch) => {\r\n          if (!sch || !sch.date) return false;\r\n          const scheduleDate = new Date(sch.date);\r\n          const isNotExpired = scheduleDate >= today;\r\n          const matchesExpress = userRole === \"SUPER_ADMIN\" ? true : (sch.express && sch.express.id === expressId);\r\n          return isNotExpired && matchesExpress && sch.express;\r\n        });\r\n\r\n        const finalSchedules = userRole !== \"SUPER_ADMIN\" && expressId\r\n          ? filteredSchedules.filter((sch) => sch.express && sch.express.id === expressId)\r\n          : filteredSchedules;\r\n\r\n        setScheduleList(finalSchedules);\r\n \r\n        try {\r\n          const busResponse = await fetch(\"http://localhost:5000/api/tickets/bus\", {\r\n            method: \"GET\",\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n              \"Content-Type\": \"application/json\",\r\n              \"X-Express-Id\": expressId || \"\",\r\n            },\r\n          });\r\n\r\n          if (busResponse.ok) {\r\n            setBusList(await busResponse.json());\r\n          }\r\n        } catch (busError) {\r\n          console.error(\"Bus fetch error:\", busError);\r\n        }\r\n \r\n        try {\r\n          const ticketsResponse = await fetch(\"http://localhost:5000/api/tickets/all\", {\r\n            method: \"GET\",\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n              \"Content-Type\": \"application/json\",\r\n              \"X-Express-Id\": expressId || \"\",\r\n            },\r\n          });\r\n\r\n          if (ticketsResponse.ok) {\r\n            setExistingTickets(await ticketsResponse.json());\r\n          }\r\n        } catch (ticketError) {\r\n          console.error(\"Tickets fetch error:\", ticketError);\r\n        }\r\n\r\n        if (userRole !== \"SUPER_ADMIN\" && expressId) {\r\n          setTicketData((prev) => ({ ...prev, express: expressId }));\r\n        }\r\n\r\n        setLoading(false);\r\n      } catch (error) {\r\n        console.error(\"Error fetching data:\", error);\r\n        setError(error.message);\r\n        setLoading(false);\r\n        alert(\"Error: \" + error.message);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [id, history]);\r\n \r\n  useEffect(() => {\r\n    if (!ticketData.schedule) return;\r\n\r\n    const selectedSchedule = scheduleList.find((s) => s.id === ticketData.schedule);\r\n    if (!selectedSchedule || !selectedSchedule.bus) return;\r\n\r\n    const bookedSeats = existingTickets\r\n      .filter((t) => t.schedule && t.schedule.id === ticketData.schedule && t.id !== id)\r\n      .map((t) => t.seatNo);\r\n\r\n    const remainingSeats = selectedSchedule.bus.busSize - bookedSeats.length;\r\n    setAvailableSeats(remainingSeats);\r\n\r\n    const nextSeat = [];\r\n    for (let i = 1; i <= selectedSchedule.bus.busSize; i++) {\r\n      if (!bookedSeats.includes(i)) {\r\n        nextSeat.push(i);\r\n      }\r\n    }\r\n    setTicketData((prev) => ({\r\n      ...prev,\r\n      seatNo: nextSeat.includes(parseInt(prev.seatNo)) ? prev.seatNo : (nextSeat.length > 0 ? nextSeat[0] : \"\"),\r\n      busPlateNo: selectedSchedule.bus.plateNo,\r\n      totalAmount: selectedSchedule.destination.cost || 0,\r\n      date: selectedSchedule.date || prev.date,  \r\n    }));\r\n  }, [ticketData.schedule, scheduleList, existingTickets, id]);\r\n \r\n  useEffect(() => {\r\n    if (role !== \"SUPER_ADMIN\" || !ticketData.express) return;\r\n\r\n    const fetchSchedulesForExpress = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"token\");\r\n\r\n        let scheduleResponse = await fetch(\"http://localhost:5000/api/tickets/schedule\", {\r\n          method: \"GET\",\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n            \"Content-Type\": \"application/json\",\r\n            \"X-Express-Id\": ticketData.express,\r\n          },\r\n        });\r\n\r\n        if (!scheduleResponse.ok) {\r\n          scheduleResponse = await fetch(\"http://localhost:5000/api/tickschedule\", {\r\n            method: \"GET\",\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n              \"Content-Type\": \"application/json\",\r\n              \"X-Express-Id\": ticketData.express,\r\n            },\r\n          });\r\n        }\r\n\r\n        if (!scheduleResponse.ok) throw new Error(\"Cannot fetch schedules for express\");\r\n\r\n        const schedules = await scheduleResponse.json();\r\n\r\n        const today = new Date();\r\n        const filteredSchedules = schedules.filter((sch) => {\r\n          if (!sch || !sch.date) return false;\r\n          const scheduleDate = new Date(sch.date);\r\n          return scheduleDate >= today && sch.express && sch.express.id === ticketData.express && sch.express;\r\n        });\r\n\r\n        setScheduleList(filteredSchedules);\r\n      } catch (error) {\r\n        console.error(\"Error fetching schedules:\", error);\r\n        setError(error.message);\r\n      }\r\n    };\r\n\r\n    fetchSchedulesForExpress();\r\n  }, [ticketData.express, role]);\r\n\r\n  const generateQRCodeData = (ticket, selectedSchedule, selectedExpress) => {\r\n    const formatDate = (dateString) => {\r\n      const date = new Date(dateString);\r\n      return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;\r\n    };\r\n\r\n    const qrData = `\r\n      Ticket: ${ticket.ticketNumber}\r\n      Express: ${selectedExpress.expressName}\r\n      Route: ${selectedSchedule.destination.fromLocation} - ${selectedSchedule.destination.toLocation}\r\n      Time: ${selectedSchedule.time}\r\n      Date: ${formatDate(selectedSchedule.date)}\r\n      Bus: ${ticket.busPlateNo}\r\n      Seat: ${ticket.seatNo}\r\n      Passenger: ${ticket.names}\r\n      Amount: ${ticket.totalAmount} Rwf\r\n      Status: ${ticket.payState}\r\n      Powered By TEGABUS\r\n    `.trim();\r\n\r\n    return qrData;\r\n  };\r\n\r\n  const generateQRCodeImage = async (qrCodeData) => {\r\n    try {\r\n      const qrCodeDataURL = await QRCode.toDataURL(qrCodeData, {\r\n        width: 120,\r\n        margin: 1,\r\n        color: {\r\n          dark: \"#2c3e50\",\r\n          light: \"#ffffff\",\r\n        },\r\n      });\r\n      return qrCodeDataURL;\r\n    } catch (error) {\r\n      console.error(\"Error generating QR code:\", error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const generatePDF = async (ticket) => {\r\n    const selectedSchedule = scheduleList.find((s) => s.id === ticket.schedule.id);\r\n    const selectedExpress = expressList.find((e) => e.id === ticket.express.id);\r\n\r\n    if (!selectedSchedule || !selectedExpress) {\r\n      console.error(\"Missing schedule or express data:\", { selectedSchedule, selectedExpress });\r\n      alert(\"Cannot generate PDF: Missing schedule or express data.\");\r\n      return;\r\n    }\r\n\r\n    const logoUrl = `http://localhost:5000/uploads/${selectedExpress.expressLogo}`;\r\n    const doc = new jsPDF();\r\n\r\n    const qrCodeData = generateQRCodeData(ticket, selectedSchedule, selectedExpress);\r\n\r\n    doc.setFillColor(74, 107, 136);\r\n    doc.rect(0, 0, 210, 25, \"F\");\r\n\r\n    doc.setFontSize(20);\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.setFont(undefined, \"bold\");\r\n    doc.text(`${selectedExpress.expressName || \"N/A\"}`, 105, 12, { align: \"center\" });\r\n\r\n    doc.setFontSize(10);\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.text(\"Premium Travel Experience\", 105, 18, { align: \"center\" });\r\n\r\n    doc.setDrawColor(200, 200, 200);\r\n    doc.setFillColor(255, 255, 255);\r\n    doc.roundedRect(10, 30, 190, 130, 8, 8, \"FD\");\r\n\r\n    doc.setDrawColor(74, 107, 136);\r\n    doc.setLineWidth(1);\r\n    doc.roundedRect(12, 32, 186, 126, 6, 6, \"S\");\r\n\r\n    doc.setFillColor(74, 107, 136);\r\n    doc.roundedRect(15, 35, 180, 15, 4, 4, \"F\");\r\n\r\n    doc.setFontSize(16);\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.setFont(undefined, \"bold\");\r\n    doc.text(\"ELECTRONIC TICKET\", 105, 45, { align: \"center\" });\r\n\r\n    doc.setFillColor(240, 240, 240);\r\n    doc.roundedRect(70, 55, 70, 8, 4, 4, \"F\");\r\n\r\n    doc.setFontSize(10);\r\n    doc.setTextColor(74, 107, 136);\r\n    doc.setFont(undefined, \"bold\");\r\n    doc.text(`Ticket #: ${ticket.ticketNumber || \"N/A\"}`, 105, 60, { align: \"center\" });\r\n\r\n    try {\r\n      const qrCodeDataURL = await generateQRCodeImage(qrCodeData);\r\n\r\n      doc.setFillColor(250, 250, 250);\r\n      doc.roundedRect(135, 70, 60, 80, 5, 5, \"F\");\r\n      doc.setDrawColor(200, 200, 200);\r\n      doc.roundedRect(135, 70, 60, 80, 5, 5, \"S\");\r\n\r\n      doc.addImage(qrCodeDataURL, \"PNG\", 140, 75, 50, 50);\r\n\r\n      doc.setFontSize(9);\r\n      doc.setTextColor(100, 100, 100);\r\n      doc.text(\"Scan Me\", 165, 130, { align: \"center\" });\r\n    } catch (error) {\r\n      console.error(\"Error generating QR code:\", error);\r\n      doc.setFontSize(8);\r\n      doc.setTextColor(0, 0, 0);\r\n      doc.text(\"QR Code Error\", 160, 85, { align: \"center\" });\r\n    }\r\n\r\n    doc.setFontSize(12);\r\n    doc.setTextColor(74, 107, 136);\r\n    doc.setFont(undefined, \"bold\");\r\n    doc.text(\"PASSENGER DETAILS\", 65, 75);\r\n\r\n    doc.setDrawColor(74, 107, 136);\r\n    doc.setLineWidth(0.5);\r\n    doc.line(20, 78, 130, 78);\r\n\r\n    doc.setFontSize(10);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFont(undefined, \"normal\");\r\n    doc.text(`Name: ${ticket.names || \"-\"}`, 20, 85);\r\n    doc.text(`Phone: ${ticket.phone || \"-\"}`, 20, 92);\r\n\r\n    doc.setFontSize(12);\r\n    doc.setTextColor(74, 107, 136);\r\n    doc.setFont(undefined, \"bold\");\r\n    doc.text(\"JOURNEY INFORMATION\", 65, 110);\r\n\r\n    doc.line(20, 113, 130, 113);\r\n\r\n    doc.setFontSize(10);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFont(undefined, \"normal\");\r\n    doc.text(\r\n      `Route: ${selectedSchedule.destination.fromLocation} - ${selectedSchedule.destination.toLocation}`,\r\n      20,\r\n      120\r\n    );\r\n    doc.text(`Time: ${selectedSchedule.time || \"-\"}`, 20, 127);\r\n    doc.text(\r\n      `Date: ${selectedSchedule.date ? new Date(selectedSchedule.date).toLocaleDateString() : \"-\"}`,\r\n      20,\r\n      134\r\n    );\r\n\r\n    doc.text(`Bus: ${ticket.busPlateNo || \"-\"}`, 20, 141);\r\n    doc.text(`Seat: ${ticket.seatNo || \"-\"}`, 80, 141);\r\n\r\n    if (ticket.payState === \"PAID\") {\r\n      doc.setFillColor(76, 175, 80);\r\n    } else {\r\n      doc.setFillColor(244, 67, 54);\r\n    }\r\n    doc.roundedRect(20, 148, 50, 8, 4, 4, \"F\");\r\n\r\n    doc.setFontSize(10);\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.text(`Status: ${ticket.payState || \"PENDING\"}`, 45, 153, { align: \"center\" });\r\n\r\n    doc.setFontSize(10);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.text(`Price: ${ticket.totalAmount || 0} Rwf`, 100, 153);\r\n\r\n    doc.setFillColor(74, 107, 136);\r\n    doc.rect(0, 165, 210, 15, \"F\");\r\n\r\n    doc.setFontSize(11);\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.text(\"Powered By TEGABUS\", 105, 172, { align: \"center\" });\r\n\r\n    doc.setFillColor(44, 62, 80);\r\n    for (let i = 0; i < 210; i += 10) {\r\n      doc.circle(i, 180, 1, \"F\");\r\n    }\r\n\r\n    doc.setFontSize(8);\r\n    doc.setTextColor(150, 150, 150);\r\n    doc.text(\r\n      \"Please present this ticket during boarding • Please come early if you delay Ticket will be Expired • Thank you for traveling with us!\",\r\n      105,\r\n      185,\r\n      { align: \"center\" }\r\n    );\r\n\r\n    doc.text(\"Generated on \" + new Date().toLocaleString(), 105, 190, { align: \"center\" });\r\n\r\n    try {\r\n      doc.addImage(logoUrl, \"PNG\", 175, 3, 25, 20, undefined, \"FAST\");\r\n    } catch (error) {\r\n      console.error(\"Error adding logo to PDF:\", error);\r\n    }\r\n\r\n    doc.save(`ticket_${ticket.ticketNumber || \"unknown\"}.pdf`);\r\n\r\n    const pdfOutput = doc.output(\"bloburl\");\r\n    const printWindow = window.open(pdfOutput);\r\n    if (printWindow) {\r\n      printWindow.onload = () => {\r\n        printWindow.print();\r\n        setTimeout(() => {\r\n          printWindow.close();\r\n        }, 500);\r\n      };\r\n    } else {\r\n      console.error(\"Failed to open print window. Ensure pop-ups are allowed.\");\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target; \r\n    if (name === \"ticketNumber\") return;\r\n    setTicketData({ ...ticketData, [name]: value });\r\n  };\r\n\r\nconst handleSubmit = async (e) => {\r\n  e.preventDefault();\r\n\r\n  if (!ticketData.seatNo) {\r\n    return alert(\"No seats available for the selected schedule.\");\r\n  }\r\n\r\n  if (!ticketData.date) {\r\n    return alert(\"Ticket date is missing. Please select a valid schedule.\");\r\n  }\r\n\r\n  try {\r\n    const token = localStorage.getItem(\"token\");\r\n    const expressId = localStorage.getItem(\"expressId\");\r\n\r\n    const payload = {\r\n      id: id,\r\n      ticketNumber: ticketData.ticketNumber, \r\n      names: ticketData.names,\r\n      phone: ticketData.phone,\r\n      express: { id: ticketData.express },\r\n      schedule: { id: ticketData.schedule },\r\n      busPlateNo: ticketData.busPlateNo,\r\n      seatNo: parseInt(ticketData.seatNo),\r\n      totalAmount: parseFloat(ticketData.totalAmount),\r\n      payState: ticketData.payState,\r\n      date: ticketData.date,  \r\n    };\r\n\r\n    console.log(\"Payload sent to backend:\", payload);\r\n\r\n    const response = await fetch(`http://localhost:5000/api/tickets/update/${id}`, {\r\n      method: \"PUT\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${token}`,\r\n        \"X-Express-Id\": expressId || \"\",\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      throw new Error(errorText || `Failed to update ticket: ${response.status}`);\r\n    }\r\n\r\n    const updatedTicket = await response.json();\r\n    alert(\"Ticket updated successfully!\");\r\n \r\n    if (updatedTicket.payState !== \"PENDING\") {\r\n      await generatePDF(updatedTicket);\r\n    } else {\r\n      console.log(\"PDF generation skipped: Payment status is PENDING\");\r\n    }\r\n\r\n    history.push(\"/admin/tickets\");\r\n  } catch (error) {\r\n    console.error(\"Error updating ticket:\", error);\r\n    alert(\"Error updating ticket: \" + error.message);\r\n  }\r\n};\r\n\r\n  const handleCancel = () => history.push(\"/admin/tickets\");\r\n\r\n  if (loading) return <p className=\"text-center p-6\">Loading...</p>;\r\n\r\n  return (\r\n    <div className=\"flex flex-wrap\">\r\n      <div className=\"w-full xl:w-8/12 mb-12 xl:mb-0 px-4 mx-auto\">\r\n        <div className=\"relative flex flex-col min-w-0 break-words w-full mb-6 shadow-lg rounded-lg bg-white border-0\">\r\n          <div className=\"rounded-t bg-white mb-0 px-6 py-6 flex justify-between items-center\">\r\n            <h6 className=\"text-blueGray-700 text-xl font-bold\">Edit Ticket</h6>\r\n            <button\r\n              onClick={handleCancel}\r\n              className=\"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600\"\r\n            >\r\n              Back\r\n            </button>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mx-6 mt-4\">\r\n              <strong className=\"font-bold\">Error: </strong>\r\n              <span className=\"block sm:inline\">{error}</span>\r\n            </div>\r\n          )}\r\n\r\n          <form onSubmit={handleSubmit} className=\"flex-auto px-4 lg:px-10 py-10 pt-0\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Ticket Number</label>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"ticketNumber\"\r\n                  value={ticketData.ticketNumber}\r\n                  readOnly\r\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Passenger Name *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"names\"\r\n                  value={ticketData.names}\r\n                  onChange={handleInputChange}\r\n                  readOnly={role !== \"SUPER_ADMIN\"}\r\n                  required\r\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Phone *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"phone\"\r\n                  value={ticketData.phone}\r\n                  onChange={handleInputChange}\r\n                  readOnly={role !== \"SUPER_ADMIN\"}\r\n                  required\r\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg\"\r\n                />\r\n              </div>\r\n\r\n              {role === \"SUPER_ADMIN\" && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">Express *</label>\r\n                  <select\r\n                    name=\"express\"\r\n                    value={ticketData.express}\r\n                    onChange={handleInputChange}\r\n                    required\r\n                    className=\"w-full px-4 py-3 border border-gray-300 rounded-lg\"\r\n                  >\r\n                    <option value=\"\">Select Express</option>\r\n                    {expressList.map((exp) => (\r\n                      <option key={exp.id} value={exp.id}>{exp.expressName}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n              )}\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Schedule *</label>\r\n                <select\r\n                  name=\"schedule\"\r\n                  value={ticketData.schedule}\r\n                  onChange={handleInputChange}\r\n                  readOnly={role !== \"SUPER_ADMIN\"}\r\n                  required\r\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg\"\r\n                >\r\n                  <option value=\"\">Select Schedule</option>\r\n                  {scheduleList.map((sch) => (\r\n                    <option key={sch.id} value={sch.id}>\r\n                      {sch.destination.fromLocation} - {sch.destination.toLocation} ({sch.date} {sch.time})\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Bus Plate Number *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"busPlateNo\"\r\n                  value={ticketData.busPlateNo}\r\n                  readOnly\r\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Seat Number * (Available: {availableSeats})\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  name=\"seatNo\"\r\n                  value={ticketData.seatNo || \"\"}\r\n                  readOnly\r\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Cost *</label>\r\n                <input\r\n                  type=\"number\"\r\n                  name=\"totalAmount\"\r\n                  value={ticketData.totalAmount}\r\n                  readOnly\r\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Payment Status *</label>\r\n                <select\r\n                  name=\"payState\"\r\n                  value={ticketData.payState}\r\n                  onChange={handleInputChange}\r\n                  required\r\n                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg\"\r\n                >\r\n                  <option value=\"PENDING\">Pending</option>\r\n                  <option value=\"PAID\">Paid</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-end space-x-4 pt-6 border-t border-gray-200\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleCancel}\r\n                className=\"px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                className=\"px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-700 transition-colors\"\r\n                disabled={availableSeats === 0 || !ticketData.date}\r\n              >\r\n                <i className=\"fas fa-ticket-alt mr-2\"></i> Save\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}